{% extends "base.html" %}

    {% block youtube_autocomplete %}
            <script src="{{ url_for('static', filename='youtube_autocomplete.js') }}"></script>
    {% endblock %}

    {% block content %}

        <div data-role="content">
            <div id="flashed-messages">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                        <div id="{{ category }}">
                            {{ message }}
                            <span id="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
                        </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

            </div>
            <div id="search">
                <strong>Request Music</strong>
                <form class="ui-filterable">
                    <input id="autocomplete-input" data-type="search" placeholder="Start typing artist and song...">
                </form>
                <ul id="autocomplete" data-role="listview" data-inset="true" data-filter="true" data-input="#autocomplete-input"></ul>
            </div>

            {% if currently_playing %}
                {% set artist = currently_playing['title'].split(' - ')[0] %}
                {% set title = currently_playing['title'].split(' - ')[1] %}
                <div id="currently-playing">
                    <ul data-role="listview" data-inset="true">
                        <li data-role="list-divider">Now Playing</li>
                        <li><img src="{{ currently_playing['thumbnail'] }}"><h2>{{ artist }}</h2><p>{{ title }}</li>
                    </ul>
                </div>
            {% endif %}

            {% if requests %}
                <div id="next-up">
                    <ul data-role="listview" data-inset="true">
                        <li data-role="list-divider">Next Up</li>
                        {% for request in requests %}
                            {% set artist = request['title'].split(' - ')[0] %}
                            {% set title = request['title'].split(' - ')[1] %}
                            <li><img src="{{ request['thumbnail'] }}"><h2>{{ artist }}</h2><p>{{ title }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            {% if currently_playing %}
                <div id="skip-ban-music">
                        <ul data-role="listview" data-inset="true">
                            <li data-role="list-divider">Skip / Ban Music</li>
                            <div data-role="collapsible">
                                <h2>{{ currently_playing['title'] }}</h2>
                                <ul data-role="listview" data-inset="true">
                                    <li><a href="/skip/1/{{ currently_playing['videoId'] }}">Skip</a></li>
                                    <li><a href="/ban/1/{{ currently_playing['videoId'] }}">Ban</a></li>
                                </ul>
                            </div>
                                {% for request in requests %}
                                    <div data-role="collapsible">
                                        <h2>{{ request['title'] }}</h2>
                                        <ul data-role="listview" data-inset="true">
                                            <li><a href="/ban/1/{{ request['videoId'] }}">Ban</a></li>
                                        </ul>
                                    </div>
                                {% endfor %}
                        </ul>
                </div>
            {% endif %}

            <div ="contact">
                Bugs, ideas, comment? Message Preston!
            </div>
        </div>

    {% endblock %}
    {% block footer%}{% endblock %}